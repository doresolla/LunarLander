# H-ESP: Иерархические эволюционирующие субпопуляции нейронов (Hierarchical Enforced SubPopulations)

Этот проект представляет собой реализацию алгоритма **H-ESP (Hierarchical Enforced SubPopulations)** для обучения нейронного агента в среде `LunarLander-v3` (OpenAI Gymnasium).

Алгоритм использует нейроэволюционный подход, в котором одновременно развиваются как отдельные нейроны, так и полные нейронные сети, благодаря двухуровневой архитектуре:

* **уровень L1** — эволюция отдельных скрытых нейронов;
* **уровень L2** — эволюция полных нейронных сетей.

## Структура проекта

* `main.ipynb` — основной ноутбук для обучения, визуализации и сохранения результатов.
* `hesp.py` — содержит основные классы: `Neuron`, `NeuronPopulation`, `OutputLayer`, `OutputPopulation`, `Network`, `NetworkPopulation`, `HESPTrainer`.
* `utils.py` — функции визуализации: `visualize_network`, `show_video_of_network`, сохранение/загрузка моделей.
* `hesp_best_gen<N>.npz` — сохранённая лучшая модель на эпохе `N`.
* `README.md` — описание проекта.

## Как запустить

1. Установите зависимости:

```bash
pip install -r requirements.txt
```

2. Запустите обучение:

```python
trainer = HESPTrainer(input_size=8, hidden_size=6, output_size=4, population_size=20, mutation_strength=0.1)
best_net, scores = trainer.evolve(env, generations=200)
```

3. Сохраните или загрузите сеть:

```python
# Сохранение
trainer.save_network(best_net.neurons, best_net.output_layer)

# Загрузка
loaded_net = load_network("hesp_best.npz")
```

4. Сгенерируйте видео поведения агента:

```python
show_video_of_network(loaded_net, env_name="LunarLander-v3", video_name="hesp_demo")
```

## Целевая метрика

Целевой метрикой является **среднее суммарное вознаграждение агента за эпизод** (Average Total Reward per Episode). Эта метрика отражает, насколько эффективно агент выполняет задачу мягкой посадки в среде LunarLander-v3. Именно по этой метрике отбираются нейроны и сети в процессе эволюции.

## Визуализация

Функция `visualize_network` строит граф нейронной сети, отображающий входные, скрытые и выходные нейроны, а также веса связей между ними (толщиной линий и подписями на рёбрах).

## Описание алгоритма

Алгоритм H-ESP использует двухуровневую эволюцию:

* скрытые нейроны развиваются в отдельных подпопуляциях (L1);
* из этих нейронов формируются сети, которые оцениваются; лучшие из них могут попасть в популяцию сетей L2;
* лучшие сети из L2 могут «передавать» свои нейроны обратно в L1;
* оба уровня эволюционируют: нейроны — по индивидуальному fitness, сети — через скрещивание и мутацию.

Такой подход позволяет сочетать модульную эволюцию (нейронов) и целостную оптимизацию (сетей), обеспечивая устойчивый и гибкий процесс обучения.

## Авторы

> Практический проект по дисциплине "Нейроэволюционные вычисления", 2025
> Студент: *\[Дондупова Очирма]*
> Руководитель: *\[Григорьев Д.С.]*

---
